import{a as oe}from"./chunk-JEHAD364.js";import{a as ne}from"./chunk-MDR7SPQX.js";import{a as H,b as O,c as p,d as K,e as J,h as Q,i as W,j as X,k as Y,p as ee,q as te,r as ie}from"./chunk-CFXI2MN7.js";import{b as G,d as U,f as B,o as D,q as Z}from"./chunk-5GV7RPBB.js";import{a as re}from"./chunk-DVYNNE2R.js";import{g as V,k as E}from"./chunk-UK3UKNHR.js";import"./chunk-AHKA4FOS.js";import{$a as d,Db as x,Eb as f,Kb as a,La as o,Mb as b,R as F,Ra as z,Sb as v,Tb as y,Ub as M,Vb as j,Wa as k,X as N,a as T,b as R,ca as I,da as P,lb as u,pb as s,qb as A,rb as q,sb as L,tb as n,ub as i,vb as m,yb as $}from"./chunk-3I64RZE3.js";var ae=(()=>{class e{constructor(){this.server=E.server,this.port=E.portUser,this.httpClient=N(V),this.insUser=t=>this.httpClient.post(`http://${this.server}:${this.port}/api/utenti/register`,t)}static{this.\u0275fac=function(c){return new(c||e)}}static{this.\u0275prov=F({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var C=e=>({"is-invalid":e}),de=(e,l,t)=>({"alert-warning":e,"alert-success":l,"alert-danger":t}),ce=(e,l,t)=>({"fa-exclamation-triangle":e,"fa-check-circle":l,"fa-times-circle":t});function pe(e,l){if(e&1&&(n(0,"div",8)(1,"div",37)(2,"div",38),m(3,"i",39),n(4,"span",40),a(5),n(6,"a",41),m(7,"i",42),a(8," Login "),i()()()()()),e&2){let t=f();o(2),u("ngClass",y(3,de,t.alertType==="warning",t.alertType==="success",t.alertType==="danger")),o(),u("ngClass",y(7,ce,t.alertType==="warning",t.alertType==="success",t.alertType==="danger")),o(2),b("",t.apiMsg.message+" Torna alla"," ")}}function ue(e,l){e&1&&(n(0,"div"),a(1,"Il username \xE8 richiesto"),i())}function fe(e,l){if(e&1&&(n(0,"div"),a(1),i()),e&2){let t=f(2);o(),b("Il username deve contenere almeno ",t.f.username.errors.minlength.requiredLength," caratteri")}}function ge(e,l){if(e&1&&(n(0,"div"),a(1),i()),e&2){let t=f(2);o(),b("Il username non pu\xF2 superare ",t.f.username.errors.maxlength.requiredLength," caratteri ")}}function _e(e,l){e&1&&(n(0,"div"),a(1," Il username non rispetta il formato supportato. "),i())}function ve(e,l){if(e&1&&(n(0,"div",12),d(1,ue,2,0,"div")(2,fe,2,1,"div")(3,ge,2,1,"div")(4,_e,2,0,"div"),i()),e&2){let t=f();o(),s(t.f.username.errors.required?1:-1),o(),s(t.f.username.errors.minlength?2:-1),o(),s(t.f.username.errors.maxlength?3:-1),o(),s(t.f.username.errors.pattern?4:-1)}}function Ce(e,l){e&1&&(n(0,"div"),a(1,"L'email \xE8 richiesta"),i())}function he(e,l){e&1&&(n(0,"div"),a(1," L'email non \xE8 valida "),i())}function xe(e,l){if(e&1&&(n(0,"div",12),d(1,Ce,2,0,"div")(2,he,2,0,"div"),i()),e&2){let t=f();o(),s(t.f.email.errors.required?1:-1),o(),s(t.f.email.errors.email?2:-1)}}function be(e,l){e&1&&(n(0,"div"),a(1,"Il cellulare \xE8 richiesto"),i())}function ze(e,l){e&1&&(n(0,"div"),a(1," Formato valido: "),m(2,"br"),a(3," - Italia: +39 o 0039 opzionale, seguito da 10 cifre "),m(4,"br"),a(5," - UK: +44 o 0044 opzionale, seguito da 10-11 cifre "),i())}function we(e,l){if(e&1&&(n(0,"div",12),d(1,be,2,0,"div")(2,ze,6,0,"div"),i()),e&2){let t=f();o(),s(t.f.cellulare.errors.required?1:-1),o(),s(t.f.cellulare.errors.pattern?2:-1)}}function ye(e,l){e&1&&(n(0,"div",12),a(1," Il nome del negozio \xE8 obbligatorio "),i())}function Ee(e,l){e&1&&(n(0,"div",12),a(1," La citt\xE0 \xE8 obbligatoria "),i())}function Se(e,l){e&1&&(n(0,"div",12),a(1," L'indirizzo \xE8 obbligatorio "),i())}function Te(e,l){if(e&1){let t=$();n(0,"div",52)(1,"button",53),x("click",function(){I(t);let r=f().$index,g=f();return P(g.rimuoviNegozio(r))}),m(2,"i",54),i()()}}function Re(e,l){if(e&1&&(n(0,"div",19)(1,"div",43)(2,"div",8)(3,"div",44)(4,"label",45),a(5,"Nome"),i(),m(6,"input",46),d(7,ye,2,0,"div",12),i(),n(8,"div",47)(9,"label",48),a(10,"Citt\xE0"),i(),m(11,"input",49),d(12,Ee,2,0,"div",12),i(),n(13,"div",44)(14,"label",50),a(15,"Indirizzo"),i(),m(16,"input",51),d(17,Se,2,0,"div",12),i(),d(18,Te,3,0,"div",52),i()()()),e&2){let t,c,r,g,S,w,le=l.$implicit,h=l.$index,_=f();o(),u("formGroup",le),o(5),u("ngClass",v(8,C,_.submitted&&((t=_.negozi.at(h).get("shopName"))==null?null:t.errors))),o(),s(!((c=_.negozi.at(h).get("shopName"))==null||c.errors==null)&&c.errors.required?7:-1),o(4),u("ngClass",v(10,C,_.submitted&&((r=_.negozi.at(h).get("shopCity"))==null?null:r.errors))),o(),s(!((g=_.negozi.at(h).get("shopCity"))==null||g.errors==null)&&g.errors.required?12:-1),o(4),u("ngClass",v(12,C,_.submitted&&((S=_.negozi.at(h).get("shopAddress"))==null?null:S.errors))),o(),s(!((w=_.negozi.at(h).get("shopAddress"))==null||w.errors==null)&&w.errors.required?17:-1),o(),s(_.negozi.length>1?18:-1)}}function Fe(e,l){e&1&&(n(0,"div"),a(1,"Il password \xE8 richiesto"),i())}function Ne(e,l){if(e&1&&(n(0,"div"),a(1),i()),e&2){let t=f(2);o(),b("Il password deve contenere almeno ",t.f.password.errors.minlength.requiredLength," caratteri")}}function Ie(e,l){if(e&1&&(n(0,"div"),a(1),i()),e&2){let t=f(2);o(),b("Il password non pu\xF2 superare ",t.f.password.errors.maxlength.requiredLength," caratteri ")}}function Pe(e,l){e&1&&(n(0,"div"),a(1," Il password non rispetta il formato supportato. "),i())}function ke(e,l){if(e&1&&(n(0,"div",12),d(1,Fe,2,0,"div")(2,Ne,2,1,"div")(3,Ie,2,1,"div")(4,Pe,2,0,"div"),i()),e&2){let t=f();o(),s(t.f.password.errors.required?1:-1),o(),s(t.f.password.errors.minlength?2:-1),o(),s(t.f.password.errors.maxlength?3:-1),o(),s(t.f.password.errors.pattern?4:-1)}}function Ae(e,l){e&1&&(n(0,"div"),a(1,"Confermare la password \xE8 obbligatorio"),i())}function qe(e,l){e&1&&(n(0,"div"),a(1,"Le password non coincidono"),i())}function Le(e,l){if(e&1&&(n(0,"div",12),d(1,Ae,2,0,"div")(2,qe,2,0,"div"),i()),e&2){let t=f();o(),s(t.f.confirmPassword.errors.required?1:-1),o(),s(t.f.confirmPassword.errors.passwordMismatch?2:-1)}}function $e(e,l){e&1&&(n(0,"div"),a(1,"Il flag \xE8 obbligatorio"),i())}function Me(e,l){if(e&1&&(n(0,"div",12),d(1,$e,2,0,"div"),i()),e&2){let t=f();o(),s(t.f.flagPrivacy.errors.required?1:-1)}}function je(e,l){e&1&&(n(0,"div",31)(1,"span",55),a(2,"Hai gi\xE0 un account?"),i(),n(3,"a",56),m(4,"i",42),a(5," Login "),i()())}var Ye=(()=>{class e{constructor(t,c,r){this.formBuilder=t,this.userService=c,this.loader=r,this.titolo="Signup",this.utente={username:"",email:"",cellulare:"",password:"",attivo:"",flagPrivacy:"",ruoli:[],negozi:[]},this.errore="",this.loading$=this.loader.loading$,this.submitted=!1,this.showAlert=!1,this.alertType="warning",this.onSuccess=g=>{this.apiMsg=g,this.onShowAlert("success"),this.reset()},this.handleError=g=>{this.errore=g,console.log(g)}}ngOnInit(){this.initializeForm()}initializeForm(){this.form=this.formBuilder.group({username:["",[p.required,p.minLength(3),p.maxLength(30),p.pattern("^[a-zA-Z0-9][a-zA-Z0-9_.]{2,29}$")]],email:["",[p.required,p.email]],cellulare:["",[p.required,p.pattern(/^((\+39|0039)?3\d{9}|(\+44|0044)?7\d{9}|(\+44|0044)?(1|2)\d{8,9})$/)]],password:["",[p.required,p.minLength(8),p.maxLength(20),p.pattern("^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$")]],confirmPassword:["",[p.required]],flagPrivacy:["",[p.required]],negozi:this.formBuilder.array([this.createNegozioForm()])},{validators:this.matchPasswords})}createNegozioForm(){return this.formBuilder.group({shopName:["",[p.required]],shopCity:["",[p.required]],shopAddress:["",[p.required]]})}aggiungiNegozio(){this.negozi.push(this.createNegozioForm())}rimuoviNegozio(t){this.negozi.length>1&&this.negozi.removeAt(t)}register(){let t=R(T({},this.form.value),{flagPrivacy:this.form.value.flagPrivacy?"Si":"No"});console.log(t),this.userService.insUser(t).subscribe({next:this.onSuccess,error:c=>this.handleError(c)})}reset(){this.submitted=!1,this.form.reset()}matchPasswords(t){let c=t.get("password"),r=t.get("confirmPassword");return!c||!r||r.errors&&!r.errors.passwordMismatch||(c.value!==r.value?r.setErrors({passwordMismatch:!0}):r.setErrors(null)),null}onSubmit(){this.submitted=!0,!this.form.invalid&&this.register()}get f(){return this.form.controls}get negozi(){return this.form.controls.negozi}get negozioFormGroups(){return this.negozi.controls}onShowAlert(t){this.alertType=t,this.showAlert=!0}static{this.\u0275fac=function(c){return new(c||e)(z(ee),z(ae),z(ne))}}static{this.\u0275cmp=k({type:e,selectors:[["app-registrazione"]],decls:64,vars:30,consts:[[1,"container-fluid","d-flex","flex-column","justify-content-start","custom-container"],[3,"title"],[1,"row"],[1,"col-12","d-flex","justify-content-center","align-items-start","mt-5"],[1,"w-100","form-container",2,"max-width","800px",3,"ngSubmit","formGroup"],[1,"card","shadow-lg","p-3"],[1,"card-header","text-center","sc-primary","fw-bold","fs-4"],[1,"card-body"],[1,"row","mt-2"],[1,"mb-3"],["for","username",1,"fw-bold","form-label"],["type","text","id","username","formControlName","username","autocomplete","off",1,"form-control",3,"ngClass"],[1,"invalid-feedback"],["for","email",1,"fw-bold","form-label"],["type","email","id","email","formControlName","email","autocomplete","off",1,"form-control",3,"ngClass"],["for","cellulare",1,"fw-bold","form-label"],["type","text","id","cellulare","formControlName","cellulare","autocomplete","off",1,"form-control",3,"ngClass"],["for","sezNegozi",1,"fw-bold","form-label"],["formArrayName","negozi"],["id","sezNegozi"],[1,"text-center","mt-3"],["type","button",1,"btn","btn-success","btn-md",3,"click"],[1,"fa-solid","fa-plus"],["for","password",1,"fw-bold","form-label"],["type","password","id","password","formControlName","password","autocomplete","off",1,"form-control",3,"ngClass"],["for","confirmPassword",1,"fw-bold","form-label"],["type","password","id","confirmPassword","formControlName","confirmPassword","autocomplete","off",1,"form-control",3,"ngClass"],[1,"mb-3","form-check"],["type","checkbox","id","flagPrivacy","formControlName","flagPrivacy","autocomplete","off",1,"form-check-input",3,"ngClass"],["for","flagPrivacy",1,"form-check-label"],["href","#"],[1,"text-center","mb-4"],[1,"d-flex","justify-content-between","mb-3"],["type","button",1,"btn","btn-primary","btn-default","w-100","me-2",3,"click"],[1,"fas","fa-user-plus","me-1"],["type","button",1,"btn","btn-secondary","btn-default","w-100",3,"click"],[1,"fas","fa-times","me-1"],[1,"col-12"],["role","alert",1,"alert","mt-3","text-center",3,"ngClass"],[1,"fas",3,"ngClass"],[1,"ms-2","me-2"],["routerLink","/login",1,"text-primary","text-decoration-none","me-2"],[1,"fas","fa-right-to-bracket","me-1"],[3,"formGroup"],[1,"col-md-4"],["for","shopName",1,"form-label","fw-bold"],["type","text","id","shopName","formControlName","shopName","placeholder","Nome negozio",1,"form-control",3,"ngClass"],[1,"col-md-3"],["for","shopCity",1,"form-label","fw-bold"],["type","text","id","shopCity","formControlName","shopCity","placeholder","Citt\xE0",1,"form-control",3,"ngClass"],["for","shopAddress",1,"form-label","fw-bold"],["type","text","id","shopAddress","formControlName","shopAddress","placeholder","Indirizzo",1,"form-control",3,"ngClass"],[1,"col-md-1","d-flex","align-items-end"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],[1,"fa-solid","fa-trash"],[1,"text-muted","me-2"],["routerLink","/login",1,"text-primary","text-decoration-none"]],template:function(c,r){c&1&&(n(0,"div",0),m(1,"app-external-header",1),n(2,"div",2)(3,"div",3)(4,"form",4),x("ngSubmit",function(){return r.register()}),n(5,"div",5)(6,"div",6),a(7," Registrazione Utente "),i(),n(8,"div",7),d(9,pe,9,11,"div",8),M(10,"async"),n(11,"div",9)(12,"label",10),a(13,"Username"),i(),m(14,"input",11),d(15,ve,5,4,"div",12),i(),n(16,"div",9)(17,"label",13),a(18,"Email"),i(),m(19,"input",14),d(20,xe,3,2,"div",12),i(),n(21,"div",9)(22,"label",15),a(23,"Cellulare"),i(),m(24,"input",16),d(25,we,3,2,"div",12),i(),n(26,"label",17),a(27,"Aggiungi negozio"),i(),n(28,"div",18),q(29,Re,19,14,"div",19,A),n(31,"div",20)(32,"button",21),x("click",function(){return r.aggiungiNegozio()}),m(33,"i",22),i()()(),n(34,"div",9)(35,"label",23),a(36,"Password"),i(),m(37,"input",24),d(38,ke,5,4,"div",12),i(),n(39,"div",9)(40,"label",25),a(41,"Conferma Password"),i(),m(42,"input",26),d(43,Le,3,2,"div",12),i(),n(44,"div",27),m(45,"input",28),n(46,"label",29),a(47," Confermo di aver letto e accettato la nostra "),n(48,"a",30),a(49,"Informativa per l'utente"),i(),a(50," e "),n(51,"a",30),a(52,"Informativa sulla privacy"),i(),a(53,". "),i(),d(54,Me,2,1,"div",12),i(),d(55,je,6,0,"div",31),n(56,"div",32)(57,"button",33),x("click",function(){return r.onSubmit()}),m(58,"i",34),a(59," Registrati "),i(),n(60,"button",35),x("click",function(){return r.reset()}),m(61,"i",36),a(62," Annulla "),i()(),m(63,"app-spinner"),i()()()()()()),c&2&&(o(),u("title",r.titolo),o(3),u("formGroup",r.form),o(5),s(j(10,16,r.loading$)===!1&&r.showAlert?9:-1),o(5),u("ngClass",v(18,C,r.submitted&&r.f.username.errors)),o(),s(r.f.username.errors?15:-1),o(4),u("ngClass",v(20,C,r.submitted&&r.f.email.errors)),o(),s(r.f.email.errors?20:-1),o(4),u("ngClass",v(22,C,r.submitted&&r.f.cellulare.errors)),o(),s(r.f.cellulare.errors?25:-1),o(4),L(r.negozioFormGroups),o(8),u("ngClass",v(24,C,r.submitted&&r.f.password.errors)),o(),s(r.f.password.errors?38:-1),o(4),u("ngClass",v(26,C,r.submitted&&r.f.confirmPassword.errors)),o(),s(r.f.confirmPassword.errors?43:-1),o(2),u("ngClass",v(28,C,r.submitted&&r.f.flagPrivacy.errors)),o(9),s(r.f.flagPrivacy.errors?54:-1),o(),s(r.showAlert?-1:55))},dependencies:[re,oe,ie,Q,O,H,K,J,W,Y,X,B,G,U,te,Z,D],styles:[".custom-container[_ngcontent-%COMP%]{min-height:calc(100vh - 60px);overflow-y:auto;padding-bottom:10px}.form-container[_ngcontent-%COMP%]{max-width:600px;margin-bottom:60px}"]})}}return e})();export{Ye as RegistrazioneComponent};
