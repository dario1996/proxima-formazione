<div class="row mt-3">
    <div class="col-12">
        <table class="table table-hover shadow-sm">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Descrizione</th>
                    <th>URL Sito</th>
                    <th class="text-center">Stato</th>
                    <th class="text-center">Azioni</th>
                </tr>
            </thead>
            <tbody>
                @for (piattaforma of piattaforme; track piattaforma.id) {
                <tr>
                    <td class="align-middle">{{ piattaforma.nome }}</td>
                    <td class="align-middle">{{ piattaforma.descrizione }}</td>
                    <td class="align-middle">{{ piattaforma.urlSito || '-' }}</td>
                    <td class="align-middle text-center">
                        <span class="badge" [class.bg-success]="piattaforma.attiva"
                            [class.bg-secondary]="!piattaforma.attiva">
                            {{ piattaforma.attiva ? 'Attiva' : 'Disabilitata' }}
                        </span>
                    </td>
                    <td class="align-middle text-center">
                        <div class="action-buttons">
                            <button class="btn btn-primary d-inline-flex align-items-center justify-content-center me-2"
                                (click)="modifica(piattaforma.id)">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </button>
                            <button class="btn btn-danger d-inline-flex align-items-center justify-content-center"
                                (click)="openModal('DELETE', piattaforma)">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<div class="mb-3 mt-3 d-flex justify-content-center">
    <button title="Aggiungi piattaforma" class="btn btn-success btn-sm" (click)="openModal('ADD')">
        Aggiungi piattaforma
        <i class="fa-solid fa-plus ms-1"></i>
    </button>
</div>
@if (isOpenModal) {
<app-modal [title]="modalTitle" (closeModal)="closeModal()">
    <div class="modal-body-content">
        @if (modalActionType === 'EDIT' || modalActionType === 'ADD') {
        <form (ngSubmit)="onSubmit()" [formGroup]="form">
            <div class="row mb-3">
                <div class="col-12">
                    <label for="nome" class="form-label">Nome</label>
                    <input id="nome" type="text" class="form-control" formControlName="nome"
                        [ngClass]="{'is-invalid': submitted && form.controls['nome'].invalid}" />
                    <div *ngIf="submitted && form.controls['nome'].invalid" class="invalid-feedback">
                        Il nome è obbligatorio (min 3, max 99 caratteri).
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-12">
                    <label for="descrizione" class="form-label">Descrizione</label>
                    <textarea id="descrizione" class="form-control" rows="3" formControlName="descrizione"
                        [ngClass]="{'is-invalid': submitted && form.controls['descrizione'].invalid}"></textarea>
                    <div *ngIf="submitted && form.controls['descrizione'].invalid" class="invalid-feedback">
                        La descrizione è obbligatoria (min 3, max 499 caratteri).
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-9">
                    <label for="urlSito" class="form-label">URL Sito</label>
                    <input id="urlSito" type="text" class="form-control" formControlName="urlSito"
                        [ngClass]="{'is-invalid': submitted && form.controls['urlSito'].invalid}" />
                    <div *ngIf="submitted && form.controls['urlSito'].invalid" class="invalid-feedback">
                        L'URL è obbligatorio (min 3, max 254 caratteri).
                    </div>
                </div>
                <div class="col-3">
                    <label for="attiva" class="form-label">Attiva</label>
                    <select id="attiva" class="form-select" formControlName="attiva"
                        [ngClass]="{'is-invalid': submitted && form.controls['attiva'].invalid}">
                        <!-- <option value="">Seleziona</option> -->
                        <option value="true">Sì</option>
                        <option value="false">No</option>
                    </select>
                    <div *ngIf="submitted && form.controls['attiva'].invalid" class="invalid-feedback">
                        Seleziona se la piattaforma è attiva.
                    </div>
                </div>
            </div>
        </form>
        }
        @else {
        <div class="alert alert-danger mt-3 text-center" role="alert">
            <i class="fas fa-exclamation-triangle"></i>
            <span class="ms-2">Sei sicuro di voler eliminare questa piattaforma?</span>
        </div>
        }
    </div>
    <div class="modal-footer-content">
        <button type="button" class="btn btn-secondary btn-sm me-2" (click)="closeModal()">
            Annulla
        </button>
        @if (modalActionType === 'EDIT' || modalActionType === 'ADD') {
        <button type="button" class="btn btn-success btn-sm" (click)="onSubmit()">
            Salva
            <i class="fa-solid fa-save ms-1"></i>
        </button>
        }
        @else {
        <button type="button" class="btn btn-danger btn-sm" (click)="onSubmit()">
            Cancella
            <i class="fa-solid fa-trash ms-1"></i>
        </button>
        }
    </div>
</app-modal>
}