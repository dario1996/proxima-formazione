<div class="page-container">
  <div class="page-header">
    <app-page-title 
      [title]="'Piano Formativo'" 
      [subtitle]="'Gestione delle assegnazioni dei corsi ai dipendenti'"
      [buttonText]="'Assegna corso'">
    </app-page-title>
<!-- 
    <button class="btn btn-primary" (click)="openAssignModal()" title="Nuova Assegnazione">
      <i class="fa-solid fa-plus me-2"></i>
      Assegna Corso
    </button> -->
  </div>
  <div class="page-content" #pageContentInner>
    <!-- <app-filtri-generici
      [filtri]="filtri"
      [valori]="valoriFiltri"
      (valoriChange)="onFiltriChange($event)">
    </app-filtri-generici> -->
  </div>
</div>

  <!-- Loading spinner -->
  <!-- <div *ngIf="isLoading" class="text-center my-4">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Caricamento...</span>
    </div>
  </div> -->

  <!-- Content -->
    <!-- Pulsante Aggiungi in alto -->
    <!-- <div class="d-flex justify-content-end mb-3">
      <button class="btn btn-success" (click)="openAssignModal()" title="Nuova assegnazione">
        <i class="fa-solid fa-plus me-2"></i>
        Assegna Corso
      </button>
    </div> -->

    

    <!-- Filtri -->
    <!-- <div class="filters-container mb-3">
      <div class="row">
        <div class="col-md-3">
          <div class="form-group">
            <label for="search">Cerca</label>
            <input type="text" id="search" class="form-control" placeholder="Dipendente o corso..."
              [(ngModel)]="searchTerm" (keyup)="onSearchChange()" />
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <label for="stato">Stato</label>
            <select id="stato" class="form-control" [(ngModel)]="selectedStato" (change)="onStatoChange()">
              <option value="">Tutti</option>
              <option *ngFor="let stato of stati" [value]="stato">
                {{ getStatoLabel(stato) }}
              </option>
            </select>
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <label for="dipendente">Dipendente</label>
            <select id="dipendente" class="form-control" [(ngModel)]="selectedDipendente"
              (change)="onDipendenteChange()">
              <option value="">Tutti</option>
              <option *ngFor="let dipendente of dipendenti" [value]="dipendente.id">
                {{ getDipendenteNomeCompleto(dipendente) }}
              </option>
            </select>
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <label for="corso">Corso</label>
            <select id="corso" class="form-control" [(ngModel)]="selectedCorso" (change)="onCorsoChange()">
              <option value="">Tutti</option>
              <option *ngFor="let corso of corsi" [value]="corso.id">
                {{ corso.nome }}
              </option>
            </select>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label>&nbsp;</label>
            <div class="d-flex gap-2">
              <div class="form-check">
                <input type="checkbox" id="obbligatorie" class="form-check-input" [(ngModel)]="soloObbligatorie"
                  (change)="onObbligatorieChange()" />
                <label class="form-check-label" for="obbligatorie">Obbligatori</label>
              </div>
              <div class="form-check">
                <input type="checkbox" id="feedback" class="form-check-input" [(ngModel)]="richiedeFeedback"
                  (change)="onFeedbackChange()" />
                <label class="form-check-label" for="feedback">Feedback Richiesto</label>
              </div>
            </div>
            <div class="mt-2">
              <button class="btn btn-secondary btn-sm" (click)="clearFilters()">
                <i class="fa-solid fa-filter-circle-xmark"></i> Pulisci Filtri
              </button>
            </div>
          </div>
        </div>
      </div>
    </div> -->

    <!-- Tabella -->
    <!-- <div class="table-container">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Dipendente</th>
            <th>Corso</th>
            <th>Data Assegnazione</th>
            <th>Stato</th>
            <th>Progresso</th>
            <th>Obbligatorio</th>
            <th class="text-center">Azioni</th>
          </tr>
        </thead>
        <tbody>
          @if (filteredAssegnazioni.length === 0) {
          <tr>
            <td colspan="7" class="text-center text-muted py-4">
              Nessuna assegnazione trovata con i filtri applicati
            </td>
          </tr>
          }
          @for (assegnazione of filteredAssegnazioni; track assegnazione.id) {
          <tr>
            <td>
              <div class="d-flex flex-column">
                <strong>{{
                  getDipendenteNomeCompleto(assegnazione.dipendente)
                  }}</strong>
                <small class="text-muted">{{
                  assegnazione.dipendente.email
                  }}</small>
              </div>
            </td>
            <td>
              <div class="d-flex flex-column">
                <strong>{{ assegnazione.corso.nome }}</strong>
                <small class="text-muted">{{
                  assegnazione.corso.piattaforma.nome
                  }}</small>
              </div>
            </td>
            <td>{{ formatDate(assegnazione.dataAssegnazione) }}</td>
            <td>
              <span class="badge" [class]="getStatoBadgeClass(assegnazione.stato)">
                {{ getStatoLabel(assegnazione.stato) }}
              </span>
            </td>
            <td>
              <div class="progress-container">
                <div class="progress" style="height: 20px">
                  <div class="progress-bar" [class.bg-success]="
                        assegnazione.percentualeCompletamento === 100
                      " [class.bg-warning]="
                        assegnazione.percentualeCompletamento > 0 &&
                        assegnazione.percentualeCompletamento < 100
                      " [class.bg-secondary]="
                        assegnazione.percentualeCompletamento === 0
                      " [style.width.%]="assegnazione.percentualeCompletamento" role="progressbar">
                    {{ assegnazione.percentualeCompletamento }}%
                  </div>
                </div>
              </div>
            </td>
            <td>
              <i class="fa-solid" [class.fa-check-circle]="assegnazione.obbligatorio"
                [class.fa-circle]="!assegnazione.obbligatorio" [class.text-danger]="assegnazione.obbligatorio"
                [class.text-muted]="!assegnazione.obbligatorio" [title]="
                    assegnazione.obbligatorio ? 'Obbligatorio' : 'Facoltativo'
                  ">
              </i>
            </td>
            <td class="align-middle text-center">
              <div class="action-buttons">
                <button class="btn btn-primary btn-action me-1" (click)="openStatusModal(assegnazione)"
                  title="Modifica stato">
                  <i class="fa-solid fa-edit"></i>
                </button>
                <button class="btn btn-danger btn-action" (click)="deleteAssegnazione(assegnazione)"
                  title="Elimina assegnazione">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>

            </td>
          </tr>
          }
        </tbody>
      </table>
    </div> -->

  <!-- Notification Modal -->
  <!-- <app-notification-modal [isOpen]="notification.isOpen" [title]="notification.title" [message]="notification.message"
    [details]="notification.details" [type]="notification.type" (closed)="closeNotification()">
  </app-notification-modal> -->

  <!-- Confirmation Modal -->
    <!-- <app-confirmation-modal [isOpen]="confirmation.isOpen" [title]="confirmation.title" [message]="confirmation.message"
      [details]="confirmation.details" [type]="confirmation.type" [isProcessing]="confirmation.isProcessing"
      confirmText="Conferma" cancelText="Annulla" (confirmed)="onConfirmationConfirmed()"
      (cancelled)="closeConfirmation()">
    </app-confirmation-modal> -->